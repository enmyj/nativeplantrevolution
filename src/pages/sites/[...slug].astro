---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
	const sites = await getCollection('sites');
	return sites.map((site) => ({
		params: { slug: site.id.replace(/\.md$/, '') },
		props: { site },
	}));
}

const { site } = Astro.props;
const { title, address, plantedDate, images } = site.data;
const { Content } = await render(site);

const formattedDate = plantedDate
	? new Date(plantedDate).toLocaleDateString('en-US', {
			year: 'numeric',
			month: 'long',
			day: 'numeric',
		})
	: null;
---

<Layout title={title}>
	<a href="/" class="back">‚Üê Back to Gardens</a>

	<h1>{title}</h1>

	<div class="meta">
		{address && <p class="address">üìç {address}</p>}
		{formattedDate && <p class="date">üå± Planted: {formattedDate}</p>}
	</div>

	{images && images.length > 0 && (
		<div class="gallery">
			{images.map((image: string) => (
				<img src={image} alt={title} />
			))}
		</div>
	)}

	<article class="content">
		<Content />
	</article>
</Layout>

<style>
	.back {
		display: inline-block;
		margin-bottom: 1.5rem;
		font-weight: 500;
	}

	.meta {
		display: flex;
		flex-wrap: wrap;
		gap: 1.5rem;
		margin-bottom: 2rem;
		color: var(--color-text-muted);
	}

	.meta p {
		margin: 0;
	}

	.gallery {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
		gap: 1rem;
		margin-bottom: 2.5rem;
	}

	.gallery img {
		width: 100%;
		height: 250px;
		object-fit: cover;
		border-radius: 12px;
		border: 1px solid var(--color-border);
	}

	.content {
		max-width: 700px;
		line-height: 1.8;
	}

	.content :global(ul) {
		padding-left: 1.5rem;
	}

	.content :global(li) {
		margin-bottom: 0.5rem;
	}

	.content :global(li::marker) {
		color: var(--color-accent);
	}

	.content :global(strong) {
		color: var(--color-heading);
	}
</style>
